<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMA AL-FIIL ‚Äî For The Brighter Future</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Great+Vibes&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>

:root{
  --navy:#1b4332;--navy2:#2d6a4f;--teal:#1b4332;--teal2:#2d6a4f;
  --gold:#c77b00;--gold2:#e8a020;--cream:#f8fffe;
  --accent:#40916c;--accent2:#52b788;--light:#d8f3dc;
  --red:#dc2626;--green:#27ae60;--white:#fff;
  --text:#1a2e1a;--muted:#5a7a6a;--border:#c8e6c9;
  --shadow:0 4px 24px rgba(27,67,50,.10);--shadow2:0 12px 48px rgba(27,67,50,.18);
  --r:14px;--r2:22px;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'Plus Jakarta Sans',sans-serif;background:#f8fffe;color:var(--text);overflow-x:hidden}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px}
/* RT BADGE */
.rt-badge{position:fixed;bottom:1.5rem;left:1.5rem;z-index:5000;background:rgba(13,43,31,.92);border:1px solid rgba(255,255,255,.15);border-radius:20px;padding:6px 14px;font-size:11px;color:rgba(255,255,255,.75);display:none;align-items:center;gap:6px;backdrop-filter:blur(10px)}
.rt-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
/* NAV */
nav{position:fixed;top:0;width:100%;z-index:1000;background:rgba(27,67,50,.97);backdrop-filter:blur(16px);border-bottom:1px solid rgba(255,255,255,.07);padding:0 2rem}
.nav-inner{max-width:1280px;margin:0 auto;height:68px;display:flex;align-items:center;justify-content:space-between}
.nav-brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:#fff}
.nav-logo{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--navy);overflow:hidden;border:2px solid rgba(255,255,255,.2);flex-shrink:0}
.nav-logo img{width:100%;height:100%;object-fit:cover}
.nav-brand-text .t1{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;line-height:1}
.nav-brand-text .t2{font-size:8px;letter-spacing:.8px;opacity:.5;text-transform:uppercase}
.nav-menu{display:flex;align-items:center;gap:2px}
.nav-menu a{color:rgba(255,255,255,.75);text-decoration:none;padding:7px 11px;border-radius:8px;font-size:13px;font-weight:500;transition:.2s}
.nav-menu a:hover,.nav-menu a.active{background:rgba(255,255,255,.1);color:#fff}
.nav-daftar{background:linear-gradient(135deg,var(--gold),var(--gold2))!important;color:var(--navy)!important;font-weight:700!important}
.hamburger{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:5px}
.hamburger span{width:22px;height:2px;background:#fff;border-radius:2px;transition:.3s}
/* HERO */
.hero{min-height:100vh;padding-top:68px;background:linear-gradient(160deg,#0d2b1f 0%,#1b4332 55%,#2d6a4f 100%);position:relative;overflow:hidden;display:flex;align-items:center}
.hero-orb1{position:absolute;top:-100px;right:-100px;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(64,145,108,.30),transparent 70%);pointer-events:none}
.hero-orb2{position:absolute;bottom:-80px;left:-80px;width:400px;height:400px;border-radius:50%;background:radial-gradient(circle,rgba(232,160,32,.20),transparent 70%);pointer-events:none}
.hero-grid{position:absolute;inset:0;opacity:.03;background-image:linear-gradient(rgba(255,255,255,.5) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.5) 1px,transparent 1px);background-size:60px 60px}
.hero-inner{max-width:1280px;margin:0 auto;padding:5rem 2rem;display:grid;grid-template-columns:1fr 480px;gap:5rem;align-items:center;position:relative;z-index:1}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(232,160,32,.15);border:1px solid rgba(232,160,32,.35);color:var(--gold2);padding:6px 16px;border-radius:20px;font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:1.5rem;animation:fadeUp .6s ease both}
.hero-h1{font-family:'Playfair Display',serif;font-size:clamp(2.8rem,5vw,4.2rem);color:#fff;line-height:1.05;margin-bottom:1rem;animation:fadeUp .7s ease both}
.hero-h1 em{color:var(--gold2);font-style:normal}
.hero-tagline{font-family:'Great Vibes',cursive;font-size:clamp(2rem,3.5vw,3rem);color:rgba(255,255,255,.55);margin-bottom:1.5rem;animation:fadeUp .8s ease both}
.hero-desc{font-size:15px;line-height:1.85;color:rgba(255,255,255,.6);margin-bottom:2.5rem;max-width:520px;animation:fadeUp .9s ease both}
.hero-ctas{display:flex;gap:12px;flex-wrap:wrap;animation:fadeUp 1s ease both}
.cta-primary{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--navy);padding:14px 28px;border-radius:11px;text-decoration:none;font-weight:700;font-size:14px;box-shadow:0 4px 18px rgba(217,119,6,.4);transition:.3s}
.cta-primary:hover{transform:translateY(-2px)}
.cta-ghost{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.07);color:#fff;padding:14px 28px;border-radius:11px;text-decoration:none;font-weight:600;font-size:14px;border:1px solid rgba(255,255,255,.2);transition:.3s}
.cta-ghost:hover{background:rgba(255,255,255,.14)}
.hero-visual{animation:fadeRight .8s ease both}
.hero-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:var(--r2);padding:1.8rem;backdrop-filter:blur(20px)}
.hero-img{width:100%;height:220px;border-radius:var(--r);overflow:hidden;background:linear-gradient(135deg,rgba(64,145,108,.3),rgba(232,160,32,.15));display:flex;align-items:center;justify-content:center;margin-bottom:1.5rem;font-size:4rem;color:rgba(255,255,255,.15);position:relative}
.hero-img img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.hero-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
.stat{text-align:center;color:#fff}
.stat-n{font-family:'Playfair Display',serif;font-size:2.2rem;color:var(--gold2);display:block;line-height:1}
.stat-l{font-size:10px;opacity:.55;letter-spacing:.5px;margin-top:4px;display:block}
/* SECTIONS */
.sec{padding:90px 2rem}
.container{max-width:1280px;margin:0 auto}
.sec-head{text-align:center;margin-bottom:3.5rem}
.sec-tag{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;padding:4px 18px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:1rem}
.sec-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,3vw,2.6rem);color:var(--navy);margin-bottom:.8rem}
.sec-desc{color:var(--muted);font-size:14px;max-width:580px;margin:0 auto;line-height:1.8}
.sec-rule{width:64px;height:4px;margin:1rem auto 0;border-radius:2px;background:linear-gradient(90deg,var(--gold2),var(--accent))}
/* PROFIL */
.profil-sec{background:#fff}
.profil-grid{display:grid;grid-template-columns:1fr 1fr;gap:5rem;align-items:center}
.profil-visual{position:relative}
.profil-img{width:100%;height:420px;border-radius:var(--r2);overflow:hidden;background:linear-gradient(135deg,var(--navy),var(--accent));display:flex;align-items:center;justify-content:center;font-size:5rem;color:rgba(255,255,255,.2);position:relative}
.profil-img img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.profil-float{position:absolute;bottom:-16px;right:-16px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--navy);padding:14px 18px;border-radius:16px;box-shadow:var(--shadow2);text-align:center}
.profil-float .n{font-size:2rem;font-weight:700;font-family:'Playfair Display',serif;line-height:1}
.profil-float .l{font-size:9px;font-weight:700;letter-spacing:1px;opacity:.8}
.profil-info h2{font-family:'Playfair Display',serif;font-size:2rem;color:var(--navy);margin-bottom:1rem}
.profil-info h2 span{color:var(--gold)}
.profil-info p{color:var(--muted);line-height:1.9;font-size:14px;margin-bottom:.85rem}
.profil-contacts{margin-top:1.5rem;display:flex;flex-direction:column;gap:10px}
.profil-contact{display:flex;align-items:center;gap:12px;font-size:13px;color:var(--muted);padding:10px 14px;background:#f0faf5;border-radius:10px}
.profil-contact i{color:var(--accent);width:18px;text-align:center}
/* VISI MISI */
.vm-sec{background:linear-gradient(160deg,#0d2b1f 0%,#1b4332 100%)}
.vm-sec .sec-title,.vm-sec .sec-desc{color:#fff}
.vm-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem}
.vm-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:var(--r2);padding:2rem;backdrop-filter:blur(10px);transition:.3s}
.vm-card:hover{transform:translateY(-4px);background:rgba(255,255,255,.09)}
.vm-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:1.4rem}
.vm-card h3{color:var(--gold2);font-family:'Playfair Display',serif;font-size:1.2rem;margin-bottom:1rem}
.vm-card p,.vm-card li{color:rgba(255,255,255,.7);font-size:13px;line-height:1.85}
.vm-card ul{list-style:none}
.vm-card li{padding:3px 0 3px 16px;position:relative}
.vm-card li::before{content:'‚ñ∏';position:absolute;left:0;color:var(--gold2);font-size:10px;top:5px}
/* FASILITAS */
.fas-sec{background:#f0faf5}
.fas-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem}
.fas-card{background:var(--white);border-radius:var(--r2);overflow:hidden;box-shadow:var(--shadow);transition:.3s;border:1px solid transparent}
.fas-card:hover{transform:translateY(-6px);box-shadow:var(--shadow2);border-color:rgba(64,145,108,.15)}
.fas-img{height:170px;overflow:hidden;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:3rem;color:rgba(255,255,255,.5)}
.fas-img img{width:100%;height:100%;object-fit:cover}
.fas-body{padding:1.3rem}
.fas-body h3{color:var(--navy);font-size:14px;font-weight:600;margin-bottom:4px}
.fas-body p{color:var(--muted);font-size:12px;line-height:1.7}
/* EKSKUL */
.ek-sec{background:#fff}
.ek-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:1.5rem}
.ek-card{background:#f0faf5;border-radius:var(--r2);overflow:hidden;border:1px solid var(--border);transition:.3s}
.ek-card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
.ek-top{padding:1.3rem;display:flex;align-items:center;gap:12px}
.ek-ic{width:50px;height:50px;border-radius:13px;flex-shrink:0;background:var(--navy);display:flex;align-items:center;justify-content:center;font-size:22px}
.ek-top h3{color:var(--navy);font-size:15px;font-weight:600}
.ek-top p{color:var(--muted);font-size:12px}
.ek-desc{padding:0 1.3rem;font-size:13px;color:var(--muted);line-height:1.75;margin-bottom:1rem}
.ek-photos{padding:0 1.3rem 1.3rem;display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.ek-photo{height:70px;border-radius:9px;overflow:hidden;background:var(--accent);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2rem;color:rgba(255,255,255,.4)}
.ek-photo img{width:100%;height:100%;object-fit:cover}
/* GURU */
.guru-sec{background:#f0faf5}
.guru-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:1.5rem}
.guru-card{background:var(--white);border-radius:var(--r2);padding:1.8rem 1.3rem;text-align:center;box-shadow:var(--shadow);transition:.3s;border:1px solid transparent}
.guru-card:hover{transform:translateY(-4px);border-color:rgba(64,145,108,.2);box-shadow:var(--shadow2)}
.guru-card.kepala{border-color:rgba(232,160,32,.4);background:linear-gradient(135deg,#fffdf0,#fff)}
.guru-photo{width:88px;height:88px;border-radius:50%;margin:0 auto 1rem;overflow:hidden;background:linear-gradient(135deg,var(--navy),var(--accent));display:flex;align-items:center;justify-content:center;font-size:2rem;color:#fff;border:3px solid var(--border)}
.guru-card.kepala .guru-photo{border-color:var(--gold2);box-shadow:0 0 0 4px rgba(232,160,32,.12)}
.guru-photo img{width:100%;height:100%;object-fit:cover}
.guru-card h3{font-size:14px;font-weight:600;color:var(--navy);margin-bottom:3px}
.guru-card .mapel{font-size:12px;color:var(--muted)}
.guru-badge{display:inline-block;margin-top:8px;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700}
.b-kepala{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--navy)}
.b-wakil{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.b-guru{background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff}
.b-staff{background:#f1f5f9;color:var(--muted)}
/* GALERI */
.gal-sec{background:#fff}
.gal-masonry{columns:4;gap:12px}
.gal-item{break-inside:avoid;margin-bottom:12px;border-radius:12px;overflow:hidden;cursor:pointer;position:relative}
.gal-item img{width:100%;display:block;transition:.4s}
.gal-item:hover img{transform:scale(1.04)}
.gal-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(27,67,50,.7),transparent 60%);opacity:0;transition:.3s;display:flex;align-items:flex-end;padding:12px}
.gal-item:hover .gal-overlay{opacity:1}
.gal-overlay span{color:#fff;font-size:12px}
.gal-ph{break-inside:avoid;margin-bottom:12px;border-radius:12px;background:linear-gradient(135deg,#f0faf5,#d8f3dc);display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:rgba(64,145,108,.3)}
/* BERITA */
.berita-sec{background:#f0faf5}
.berita-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
.berita-card{background:var(--white);border-radius:var(--r2);overflow:hidden;box-shadow:var(--shadow);transition:.3s}
.berita-card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
.berita-thumb{height:190px;overflow:hidden;background:linear-gradient(135deg,var(--navy),var(--accent));display:flex;align-items:center;justify-content:center;font-size:3rem;color:rgba(255,255,255,.3)}
.berita-thumb img{width:100%;height:100%;object-fit:cover}
.berita-body{padding:1.5rem}
.berita-meta{display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
.berita-kat{padding:3px 10px;border-radius:10px;font-size:10px;font-weight:700;background:var(--accent);color:#fff}
.berita-tgl{font-size:11px;color:var(--muted);display:flex;align-items:center;gap:4px}
.berita-body h3{font-size:15px;font-weight:600;color:var(--text);margin-bottom:6px;line-height:1.45}
.berita-body p{font-size:13px;color:var(--muted);line-height:1.75}
.berita-more{display:inline-flex;align-items:center;gap:4px;margin-top:1rem;color:var(--accent);font-size:13px;font-weight:600;cursor:pointer}
/* KONTAK */
.kontak-sec{background:linear-gradient(160deg,#0d2b1f,#1b4332)}
.kontak-sec .sec-title,.kontak-sec .sec-desc{color:#fff}
.kontak-grid{display:grid;grid-template-columns:1fr 1fr;gap:5rem}
.kontak-info-h{font-family:'Playfair Display',serif;color:var(--gold2);font-size:1.2rem;margin-bottom:1.5rem}
.kitem{display:flex;gap:14px;margin-bottom:1.4rem;align-items:flex-start}
.kic{width:48px;height:48px;flex-shrink:0;background:rgba(255,255,255,.08);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:17px;color:var(--gold2)}
.ktxt h4{color:#fff;font-size:14px;margin-bottom:3px}
.ktxt p,.ktxt a{color:rgba(255,255,255,.6);font-size:13px;text-decoration:none;line-height:1.6}
.ktxt a:hover{color:var(--gold2)}
.sosmed-row{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:1.5rem}
.sosmed-btn{display:flex;align-items:center;gap:10px;padding:11px 14px;background:rgba(255,255,255,.07);border-radius:11px;text-decoration:none;color:#fff;font-size:13px;border:1px solid rgba(255,255,255,.09);transition:.3s}
.sosmed-btn:hover{background:rgba(255,255,255,.14);transform:translateY(-2px)}
.kontak-form-h{font-family:'Playfair Display',serif;color:var(--gold2);font-size:1.2rem;margin-bottom:1.5rem}
.fg{margin-bottom:12px}
.flbl{display:block;font-size:11px;font-weight:600;color:rgba(255,255,255,.5);margin-bottom:5px;letter-spacing:.5px}
.finp{width:100%;padding:11px 14px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);border-radius:10px;color:#fff;font-size:13px;outline:none;font-family:'Plus Jakarta Sans',sans-serif;transition:.2s}
.finp:focus{border-color:var(--gold2);background:rgba(255,255,255,.1)}
.finp::placeholder{color:rgba(255,255,255,.25)}
.finp.ta{resize:vertical;min-height:100px}
.fsend{width:100%;padding:13px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--navy);border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:.3s;margin-top:4px}
.fsend:hover{transform:translateY(-2px)}
/* FOOTER */
footer{background:#0a1f14;padding:3rem 2rem 2rem;color:rgba(255,255,255,.5)}
.footer-inner{max-width:1280px;margin:0 auto}
.footer-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}
.footer-brand{font-family:'Playfair Display',serif;font-size:1.5rem;color:#fff;cursor:default;user-select:none}
.footer-brand span{color:var(--gold2)}
.footer-bottom{border-top:1px solid rgba(255,255,255,.07);padding-top:1.5rem;font-size:12px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:.5rem}
.sync-status{display:inline-flex;align-items:center;gap:6px;font-size:11px;color:rgba(255,255,255,.5)}
.sync-status::before{content:'';width:7px;height:7px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}
.sync-status.syncing::before{background:var(--gold2)}
.sync-status.offline::before{background:var(--red);animation:none}
/* LIGHTBOX */
#lightbox{position:fixed;inset:0;z-index:50000;background:rgba(0,0,0,.94);display:none;align-items:center;justify-content:center}
#lightbox.on{display:flex}
#lightbox img{max-width:90vw;max-height:80vh;border-radius:12px;object-fit:contain}
.lb-close{position:absolute;top:1.5rem;right:1.5rem;background:rgba(255,255,255,.1);border:none;border-radius:50%;width:48px;height:48px;color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
/* MODALS */
.modal-bg{position:fixed;inset:0;z-index:20000;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:1.5rem}
.modal-bg.on{display:flex}
.modal-box{background:var(--white);border-radius:var(--r2);width:100%;max-width:560px;max-height:88vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.35);animation:popIn .3s ease both}
.modal-head{padding:1.3rem 1.8rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--white);z-index:1;border-radius:var(--r2) var(--r2) 0 0}
.modal-head h2{font-family:'Playfair Display',serif;color:var(--navy);font-size:1.1rem}
.modal-x{width:34px;height:34px;border-radius:50%;background:#f0faf5;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:16px;transition:.2s}
.modal-x:hover{background:var(--gold2);color:var(--navy)}
.modal-body{padding:1.8rem}
/* LOGIN */
.login-icon{width:60px;height:60px;background:linear-gradient(135deg,var(--navy),var(--accent));border-radius:16px;margin:0 auto 1.2rem;display:flex;align-items:center;justify-content:center;font-size:26px;color:#fff}
.login-desc{text-align:center;color:var(--muted);font-size:13px;margin-bottom:1.5rem;line-height:1.7}
.linp{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:10px;font-size:14px;outline:none;font-family:'Plus Jakarta Sans',sans-serif;transition:.2s;margin-bottom:10px}
.linp:focus{border-color:var(--accent)}
.lbtn{width:100%;padding:13px;background:linear-gradient(135deg,var(--navy),var(--accent));color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:.3s}
.lbtn:hover{opacity:.9;transform:translateY(-1px)}
/* PANDUAN */
.p-step{display:flex;gap:12px;margin-bottom:1.3rem}
.p-n{width:30px;height:30px;border-radius:50%;background:var(--navy);color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
.p-step h4{font-size:14px;font-weight:600;color:var(--navy);margin-bottom:3px}
.p-step p{font-size:12px;color:var(--muted);line-height:1.7}
.p-note{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:1rem;margin-top:1rem;font-size:12px;color:#166534;line-height:1.7}
.p-warn{background:#fff7ed;border:1px solid #fed7aa;border-radius:10px;padding:1rem;margin-top:.5rem;font-size:12px;color:#92400e;line-height:1.7}
/* ADMIN PANEL */
#adminPanel{position:fixed;inset:0;z-index:30000;background:#0a1a10;display:none;flex-direction:column;overflow:hidden}
#adminPanel.on{display:flex}
.adm-top{background:linear-gradient(135deg,#0d2b1f,#1b4332);padding:0 1.5rem;height:60px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.07);flex-shrink:0}
.adm-top h1{color:#fff;font-family:'Playfair Display',serif;font-size:1.1rem;display:flex;align-items:center;gap:8px}
.adm-top-r{display:flex;gap:8px}
.adm-btn{padding:7px 14px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:700;font-family:'Plus Jakarta Sans',sans-serif;transition:.2s;display:inline-flex;align-items:center;gap:6px}
.adm-ghost{background:rgba(255,255,255,.09);color:#fff}
.adm-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--navy)}
.adm-red{background:var(--red);color:#fff}
.adm-teal{background:var(--accent);color:#fff}
.adm-btn:hover{opacity:.85;transform:translateY(-1px)}
.adm-layout{display:flex;flex:1;min-height:0}
.adm-sidebar{width:220px;background:#0a1f14;padding:1.5rem 0.8rem;overflow-y:auto;flex-shrink:0;border-right:1px solid rgba(255,255,255,.06)}
.adm-nav-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:10px;color:rgba(255,255,255,.5);cursor:pointer;font-size:12px;font-weight:500;transition:.2s;margin-bottom:3px}
.adm-nav-item:hover{color:#fff;background:rgba(255,255,255,.06)}
.adm-nav-item.on{background:var(--accent);color:#fff}
.adm-nav-item i{width:18px;text-align:center;font-size:13px}
.adm-stitle{font-size:9px;font-weight:700;letter-spacing:2px;color:rgba(255,255,255,.25);text-transform:uppercase;padding:10px 12px 4px;margin-top:8px}
.adm-content{flex:1;overflow-y:auto;padding:1.8rem;background:#0c1f14}
.adm-sec{display:none}
.adm-sec.on{display:block}
.adm-sec-title{font-family:'Playfair Display',serif;font-size:1.4rem;color:#fff;margin-bottom:1.5rem;padding-bottom:.8rem;border-bottom:1px solid rgba(255,255,255,.07)}
.adm-card{background:#0f2a1c;border-radius:var(--r);padding:1.4rem;margin-bottom:1.2rem;border:1px solid rgba(255,255,255,.05)}
.adm-card-title{color:var(--gold2);font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:1rem}
.ai{width:100%;padding:10px 13px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:9px;color:#fff;font-size:13px;margin-bottom:8px;outline:none;font-family:'Plus Jakarta Sans',sans-serif;transition:.2s}
.ai:focus{border-color:var(--gold2);background:rgba(255,255,255,.08)}
.ai::placeholder{color:rgba(255,255,255,.25)}
.ai.ta{resize:vertical;min-height:90px}
.albl{font-size:11px;color:rgba(255,255,255,.4);margin-bottom:4px;display:block;font-weight:600;letter-spacing:.3px}
.ag2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.ag3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.upz{border:2px dashed rgba(255,255,255,.18);border-radius:11px;padding:1.8rem;text-align:center;cursor:pointer;transition:.2s;position:relative}
.upz:hover{border-color:var(--gold2);background:rgba(232,160,32,.05)}
.upz i{font-size:2rem;color:rgba(255,255,255,.25);display:block;margin-bottom:8px}
.upz p{color:rgba(255,255,255,.35);font-size:12px}
.upz input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.alist-item{background:rgba(255,255,255,.04);border-radius:10px;padding:11px 14px;margin-bottom:6px;display:flex;align-items:center;justify-content:space-between;border:1px solid rgba(255,255,255,.04)}
.alist-content h4{color:#fff;font-size:13px;margin-bottom:2px}
.alist-content p{color:rgba(255,255,255,.4);font-size:11px}
.alist-actions{display:flex;gap:5px}
.adel{background:rgba(220,38,38,.2);color:#f87171;border:none;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:11px;transition:.2s}
.adel:hover{background:var(--red);color:#fff}
.pgrid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:8px}
.pitem{aspect-ratio:1;border-radius:8px;overflow:hidden;position:relative;background:rgba(255,255,255,.05)}
.pitem img{width:100%;height:100%;object-fit:cover}
.prm{position:absolute;top:3px;right:3px;background:rgba(220,38,38,.85);color:#fff;border:none;border-radius:50%;width:20px;height:20px;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.prog{display:flex;align-items:center;gap:8px;margin:.6rem 0;font-size:12px;color:rgba(255,255,255,.5)}
.prog-bar{flex:1;height:4px;background:rgba(255,255,255,.1);border-radius:2px;overflow:hidden}
.prog-fill{height:100%;background:var(--gold2);border-radius:2px;transition:width .3s}
/* TOAST */
#toast{position:fixed;bottom:2rem;right:2rem;z-index:99999;background:var(--navy);color:#fff;padding:12px 18px;border-radius:11px;font-size:13px;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,.3);transform:translateY(20px);opacity:0;pointer-events:none;transition:all .3s;border-left:4px solid var(--accent);display:flex;align-items:center;gap:8px;max-width:320px}
#toast.on{transform:translateY(0);opacity:1}
#toast.ok{border-left-color:var(--green)}
#toast.err{border-left-color:var(--red)}
#toast.warn{border-left-color:var(--gold2)}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeRight{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
@keyframes popIn{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
@media(max-width:900px){
  .hero-inner{grid-template-columns:1fr}
  .hero-visual{display:none}
  .profil-grid,.kontak-grid{grid-template-columns:1fr}
  .vm-grid{grid-template-columns:1fr}
  .fas-grid{grid-template-columns:repeat(2,1fr)}
  .gal-masonry{columns:2}
  .adm-layout{flex-direction:column}
  .adm-sidebar{width:100%;padding:.8rem}
  .ag2,.ag3{grid-template-columns:1fr}
  .nav-menu{display:none}
  .hamburger{display:flex}
  .nav-menu.open{display:flex;flex-direction:column;position:absolute;top:68px;left:0;right:0;background:rgba(27,67,50,.98);padding:1rem;gap:4px}
}
@media(max-width:600px){
  .fas-grid{grid-template-columns:1fr}
  .gal-masonry{columns:1}
  .pgrid{grid-template-columns:repeat(3,1fr)}
}

/* SETUP PANEL extra */
.sync-status{display:inline-flex;align-items:center;gap:6px;font-size:11px;color:rgba(255,255,255,.5)}
.sync-status.offline{color:#f87171}
.sync-status.syncing{color:var(--gold2)}
</style>

<!-- SETUP PANEL -->
<div class="modal-bg" id="setupPanel">
  <div class="modal-box" style="max-width:520px">
    <div class="modal-head"><h2>‚öôÔ∏è Setup Koneksi Website</h2><button class="modal-x" onclick="closeSetup()"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:1rem;margin-bottom:1.2rem;font-size:12px;color:#14532d;line-height:1.8">
        <strong>‚úÖ Gratis total ‚Äî tanpa kartu kredit:</strong><br>
        ‚Ä¢ <strong>Firestore</strong> (data teks): gratis selamanya di Spark plan<br>
        ‚Ä¢ <strong>Cloudinary</strong> (foto): gratis 25GB, tanpa kartu kredit
      </div>
      <div style="background:#fff7ed;border:1px solid #fed7aa;border-radius:10px;padding:1rem;margin-bottom:1.5rem;font-size:12px;color:#92400e;line-height:1.8">
        <strong>üìã Cara mendapatkan nilai-nilai ini:</strong><br>
        <strong>Project ID Firestore:</strong> console.firebase.google.com ‚Üí Project Settings ‚Üí Project ID<br>
        <strong>Cloud Name Cloudinary:</strong> cloudinary.com ‚Üí Dashboard ‚Üí Cloud Name<br>
        <strong>Upload Preset:</strong> Cloudinary ‚Üí Settings ‚Üí Upload ‚Üí Add upload preset ‚Üí pilih "Unsigned"
      </div>
      <label style="font-size:11px;font-weight:700;color:var(--muted);display:block;margin-bottom:4px">FIRESTORE PROJECT ID *</label>
      <input class="linp" id="cfgProject" placeholder="contoh: sma-alfiil-website">
      <label style="font-size:11px;font-weight:700;color:var(--muted);display:block;margin-bottom:4px;margin-top:10px">CLOUDINARY CLOUD NAME (untuk upload foto)</label>
      <input class="linp" id="cfgCloud" placeholder="contoh: dxxxxxxxxxxx">
      <label style="font-size:11px;font-weight:700;color:var(--muted);display:block;margin-bottom:4px;margin-top:10px">CLOUDINARY UPLOAD PRESET (unsigned)</label>
      <input class="linp" id="cfgPreset" placeholder="contoh: smaalfiil_upload">
      <button class="lbtn" onclick="saveSetup()" style="margin-top:14px">üöÄ Simpan & Hubungkan</button>
    </div>
  </div>
</div>



</head>
<body>

<!-- RT BADGE -->
<div class="rt-badge" id="rtBadge"><div class="rt-dot"></div>Live ¬∑ Sinkron Otomatis</div>

<!-- NAV -->
<nav>
  <div class="nav-inner">
    <a class="nav-brand" href="#home">
      <div class="nav-logo" id="navLogo">üêò</div>
      <div class="nav-brand-text">
        <div class="t1">SMA AL-FIIL</div>
        <div class="t2">Gajah Mekar ¬∑ Kutawaringin ¬∑ Kab. Bandung</div>
      </div>
    </a>
    <div class="nav-menu" id="navMenu">
      <a href="#home">Beranda</a>
      <a href="#profil">Profil</a>
      <a href="#visi-misi">Visi &amp; Misi</a>
      <a href="#ekstrakurikuler">Ekskul</a>
      <a href="#guru">Guru</a>
      <a href="#galeri">Galeri</a>
      <a href="#berita">Berita</a>
      <a href="#kontak">Kontak</a>
      <a href="https://taplink.cc/smaalfiil" target="_blank" class="nav-daftar">Daftar</a>
    </div>
    <div class="hamburger" id="hamburger" onclick="toggleNav()"><span></span><span></span><span></span></div>
  </div>
</nav>

<!-- HERO -->
<section id="home" class="hero">
  <div class="hero-orb1"></div><div class="hero-orb2"></div><div class="hero-grid"></div>
  <div class="hero-inner">
    <div class="hero-text">
      <div class="hero-badge"><i class="fas fa-star"></i> EST. 3 MEI 2006</div>
      <h1 class="hero-h1">SMA <em>AL-FIIL</em></h1>
      <div class="hero-tagline">For The Brighter Future</div>
      <p class="hero-desc" id="heroDesc">Lembaga pendidikan menengah atas yang membentuk generasi tangguh, mandiri, dan siap mengabdi dengan nilai kebersamaan dan karakter mulia.</p>
      <div class="hero-ctas">
        <a href="#profil" class="cta-primary"><i class="fas fa-compass"></i> Kenali Kami</a>
        <a href="https://taplink.cc/smaalfiil" target="_blank" class="cta-ghost"><i class="fas fa-graduation-cap"></i> Pendaftaran</a>
      </div>
    </div>
    <div class="hero-visual">
      <div class="hero-card">
        <div class="hero-img" id="heroImgBox"><span>üè´</span><img id="heroImgEl" src="" alt="" style="display:none"></div>
        <div class="hero-stats">
          <div class="stat"><span class="stat-n">2006</span><span class="stat-l">Didirikan</span></div>
          <div class="stat"><span class="stat-n">18+</span><span class="stat-l">Tahun</span></div>
          <div class="stat"><span class="stat-n">100%</span><span class="stat-l">Dedikasi</span></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- PROFIL -->
<section id="profil" class="sec profil-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Tentang Kami</span><h2 class="sec-title">Profil Sekolah</h2><div class="sec-rule"></div></div>
    <div class="profil-grid">
      <div class="profil-visual">
        <div class="profil-img" id="profilImgBox"><span>üè´</span><img id="profilImgEl" src="" alt="" style="display:none"></div>
        <div class="profil-float"><div class="n">18+</div><div class="l">TAHUN</div></div>
      </div>
      <div class="profil-info">
        <h2>SMA AL-FIIL<br><span>Gajah Mekar - Kutawaringin - Kab. Bandung</span></h2>
        <div id="profilTeks">
          <p>SMA AL-FIIL merupakan lembaga pendidikan menengah atas yang berdiri sejak <strong>3 Mei 2006</strong>, dengan komitmen kuat dalam membentuk generasi yang tangguh, mandiri, dan siap mengabdi.</p>
          <p>Sekolah hadir tidak hanya menekankan pencapaian akademik, tetapi juga pembentukan karakter, akhlak mulia, serta nilai kebersamaan dalam lingkungan yang religius dan kekeluargaan.</p>
          <p>Dengan tenaga pendidik berdedikasi serta program pendidikan berimbang antara akademik, karakter, dan ekstrakurikuler, SMA AL-FIIL menciptakan lingkungan belajar yang aman, nyaman, dan inspiratif.</p>
        </div>
        <div class="profil-contacts">
          <div class="profil-contact"><i class="fas fa-map-marker-alt"></i><span id="infoAlamat">Jln. Gajah Eretan No. 19, Gajah Mekar - Kutawaringin, Kab. Bandung</span></div>
          <div class="profil-contact"><i class="fas fa-envelope"></i><span id="infoEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0e7d636f6f62686767623f3b4e69636f6762206d6163">[email&#160;protected]</a></span></div>
          <div class="profil-contact"><i class="fab fa-whatsapp"></i><span id="infoWa">085659627944</span></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- VISI MISI -->
<section id="visi-misi" class="sec vm-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Dasar Pendidikan</span><h2 class="sec-title">Visi, Misi &amp; Tujuan</h2><div class="sec-rule"></div></div>
    <div class="vm-grid">
      <div class="vm-card"><div class="vm-icon" style="background:rgba(232,160,32,.2)">üëÅÔ∏è</div><h3>Visi</h3><p id="visiTeks">"Terwujudnya sekolah yang berprestasi, mandiri, dan kreatif berdasarkan iman dan taqwa."</p></div>
      <div class="vm-card"><div class="vm-icon" style="background:rgba(64,145,108,.2)">üéØ</div><h3>Misi</h3><ul id="misiList"><li>Meningkatkan keimanan dan ketaqwaan bagi seluruh warga sekolah</li><li>Melaksanakan proses pembelajaran yang interaktif, inspiratif dan menyenangkan</li><li>Menciptakan suasana lingkungan sekolah yang kondusif untuk KBM</li><li>Mewujudkan fasilitas sekolah yang memadai</li><li>Meningkatkan prestasi dan kreatifitas siswa di bidang seni, budaya dan olah raga</li><li>Meningkatkan ketrampilan siswa di bidang kewirausahaan</li></ul></div>
      <div class="vm-card"><div class="vm-icon" style="background:rgba(220,38,38,.15)">üèÜ</div><h3>Tujuan</h3><ul id="tujuanList"><li>Terwujudnya lingkungan sekolah yang religius</li><li>Terciptanya lingkungan belajar yang kondusif dan nyaman</li><li>Terwujudnya peningkatan prestasi akademik yang unggul</li><li>Terwujudnya lulusan yang berkualitas dan siap kerja</li><li>Terciptanya kemitraan harmonis dengan berbagai pihak</li></ul></div>
    </div>
  </div>
</section>

<!-- FASILITAS -->
<section id="fasilitas" class="sec fas-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Sarana &amp; Prasarana</span><h2 class="sec-title">Fasilitas Sekolah</h2><div class="sec-rule"></div></div>
    <div class="fas-grid" id="fasilitasGrid"></div>
  </div>
</section>

<!-- EKSKUL -->
<section id="ekstrakurikuler" class="sec ek-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Kegiatan Siswa</span><h2 class="sec-title">Ekstrakurikuler</h2><div class="sec-rule"></div></div>
    <div class="ek-grid" id="ekskulGrid"></div>
  </div>
</section>

<!-- GURU -->
<section id="guru" class="sec guru-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Tenaga Pendidik</span><h2 class="sec-title">Guru &amp; Kepala Sekolah</h2><div class="sec-rule"></div></div>
    <div class="guru-grid" id="guruGrid"></div>
  </div>
</section>

<!-- GALERI -->
<section id="galeri" class="sec gal-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Dokumentasi</span><h2 class="sec-title">Galeri Foto</h2><div class="sec-rule"></div></div>
    <div class="gal-masonry" id="galeriGrid"><div class="gal-ph" style="height:180px">üì∑</div><div class="gal-ph" style="height:120px">üñºÔ∏è</div><div class="gal-ph" style="height:200px">üéûÔ∏è</div><div class="gal-ph" style="height:140px">üì∏</div></div>
  </div>
</section>

<!-- BERITA -->
<section id="berita" class="sec berita-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Informasi Terkini</span><h2 class="sec-title">Berita &amp; Pengumuman</h2><div class="sec-rule"></div></div>
    <div class="berita-grid" id="beritaGrid"></div>
  </div>
</section>

<!-- KONTAK -->
<section id="kontak" class="sec kontak-sec">
  <div class="container">
    <div class="sec-head"><span class="sec-tag">Hubungi Kami</span><h2 class="sec-title">Kontak &amp; Media Sosial</h2><div class="sec-rule"></div></div>
    <div class="kontak-grid">
      <div>
        <h3 class="kontak-info-h">Informasi Kontak</h3>
        <div class="kitem"><div class="kic"><i class="fas fa-map-marker-alt"></i></div><div class="ktxt"><h4>Alamat</h4><p id="ktAlamat">Jln. Gajah Eretan No. 19, Gajah Mekar - Kutawaringin, Kab. Bandung</p></div></div>
        <div class="kitem"><div class="kic"><i class="fas fa-envelope"></i></div><div class="ktxt"><h4>Email</h4><a id="ktEmail" href="/cdn-cgi/l/email-protection#d6a5bbb7b7bab0bfbfbae7e396b1bbb7bfbaf8b5b9bb"><span class="__cf_email__" data-cfemail="3e4d535f5f52585757520f0b7e59535f5752105d5153">[email&#160;protected]</span></a></div></div>
        <div class="kitem"><div class="kic"><i class="fab fa-whatsapp"></i></div><div class="ktxt"><h4>WhatsApp</h4><a href="https://wa.me/6285659627944" target="_blank">085659627944</a></div></div>
        <div class="sosmed-row">
          <a class="sosmed-btn" href="https://instagram.com/smaalfiil" target="_blank"><i class="fab fa-instagram" style="color:#E1306C"></i> @smaalfiil</a>
          <a class="sosmed-btn" href="https://tiktok.com/@smaalfiil" target="_blank"><i class="fab fa-tiktok"></i> @smaalfiil</a>
          <a class="sosmed-btn" href="https://youtube.com/@smaalfiil" target="_blank"><i class="fab fa-youtube" style="color:#FF0000"></i> @smaalfiil</a>
          <a class="sosmed-btn" href="https://wa.me/6285659627944" target="_blank"><i class="fab fa-whatsapp" style="color:#25D366"></i> WhatsApp</a>
        </div>
      </div>
      <div>
        <h3 class="kontak-form-h">Kirim Pesan</h3>
        <div class="fg"><label class="flbl">NAMA</label><input class="finp" id="fNama" placeholder="Nama lengkap"></div>
        <div class="fg"><label class="flbl">EMAIL</label><input class="finp" id="fEmail" placeholder="email@contoh.com"></div>
        <div class="fg"><label class="flbl">SUBJEK</label><input class="finp" id="fSubjek" placeholder="Subjek pesan"></div>
        <div class="fg"><label class="flbl">PESAN</label><textarea class="finp ta" id="fPesan" placeholder="Tulis pesan Anda..."></textarea></div>
        <button class="fsend" onclick="kirimWA()"><i class="fab fa-whatsapp"></i> Kirim via WhatsApp</button>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="footer-inner">
    <div class="footer-top">
      <div class="footer-brand" id="footerBrand">SMA <span>AL-FIIL</span></div>
      <div style="font-size:12px;color:rgba(255,255,255,.35)">Jln. Gajah Eretan No. 19 ¬∑ Gajah Mekar ¬∑ Kutawaringin ¬∑ Kab. Bandung</div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2025 SMA AL-FIIL ‚Äî Gajah Mekar, Kutawaringin, Kab. Bandung</span>
      <span class="sync-status" id="syncStatus">Data tersimpan lokal</span>
    </div>
  </div>
</footer>

<!-- LIGHTBOX -->
<div id="lightbox" onclick="closeLightbox()">
  <button class="lb-close"><i class="fas fa-times"></i></button>
  <img id="lbImg" src="" alt="">
</div>

<!-- LOGIN -->
<div class="modal-bg" id="loginModal">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-head"><h2>Masuk Admin</h2><button class="modal-x" onclick="closeModal('loginModal')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <div class="login-icon"><i class="fas fa-shield-alt"></i></div>
      <p class="login-desc">Masukkan password untuk mengakses panel pengelolaan website.</p>
      <input type="password" class="linp" id="loginPw" placeholder="Password" onkeypress="if(event.key==='Enter')doLogin()">
      <button class="lbtn" onclick="doLogin()">Masuk</button>
    </div>
  </div>
</div>

<!-- PANDUAN -->
<div class="modal-bg" id="panduanModal">
  <div class="modal-box" style="max-width:620px">
    <div class="modal-head"><h2>üìñ Panduan Website SMA AL-FIIL</h2><button class="modal-x" onclick="closeModal('panduanModal')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <h3 style="color:var(--accent);font-size:15px;margin-bottom:1.2rem">Cara Akses Admin (Tersembunyi)</h3>
      <div class="p-step"><div class="p-n">1</div><div><h4>Keyboard</h4><p>Ketik <kbd style="background:#f1f5f9;padding:2px 6px;border-radius:4px">A‚ÜíD‚ÜíM‚ÜíI‚ÜíN</kbd> berurutan saat tidak ada kolom input aktif.</p></div></div>
      <div class="p-step"><div class="p-n">2</div><div><h4>Klik Logo Footer</h4><p>Klik teks "SMA AL-FIIL" di footer sebanyak <strong>5 kali cepat</strong>.</p></div></div>
      <div class="p-step"><div class="p-n">3</div><div><h4>URL Hash</h4><p>Tambahkan <code style="background:#f1f5f9;padding:2px 5px;border-radius:4px">#admin-panel</code> di akhir URL.</p></div></div>
      <div class="p-note">‚úÖ <strong>Gratis total tanpa kartu kredit!</strong><br>
      ‚Ä¢ <strong>Firestore</strong>: data teks tersinkron ke semua perangkat secara real-time<br>
      ‚Ä¢ <strong>Cloudinary</strong>: penyimpanan foto gratis 25GB<br>
      Password default: <strong>alfiil2024</strong></div>
      <div class="p-warn">‚ö†Ô∏è Setup diperlukan sekali saja. Setelah setup, perubahan admin langsung tampil di HP, laptop, dan semua perangkat dalam hitungan detik.</div>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <div class="adm-top">
    <h1>üåø Admin Panel ‚Äî SMA AL-FIIL
      <span id="admSyncBadge" style="margin-left:10px;font-size:11px;background:rgba(39,174,96,.2);color:#86efac;padding:3px 10px;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-weight:600">‚óè Live</span>
    </h1>
    <div class="adm-top-r">
      <button class="adm-btn adm-ghost" onclick="openPanduan()"><i class="fas fa-question-circle"></i> Panduan</button>
      <button class="adm-btn adm-red" onclick="logoutAdmin()"><i class="fas fa-sign-out-alt"></i> Keluar</button>
    </div>
  </div>
  <div class="adm-layout">
    <div class="adm-sidebar">
      <div class="adm-stitle">Konten Utama</div>
      <div class="adm-nav-item on" onclick="switchTab('umum',this)"><i class="fas fa-cog"></i> Umum &amp; Foto</div>
      <div class="adm-nav-item" onclick="switchTab('profil',this)"><i class="fas fa-school"></i> Profil</div>
      <div class="adm-nav-item" onclick="switchTab('vismis',this)"><i class="fas fa-eye"></i> Visi Misi</div>
      <div class="adm-stitle">Fitur</div>
      <div class="adm-nav-item" onclick="switchTab('fasilitas',this)"><i class="fas fa-building"></i> Fasilitas</div>
      <div class="adm-nav-item" onclick="switchTab('ekskul',this)"><i class="fas fa-running"></i> Ekskul</div>
      <div class="adm-nav-item" onclick="switchTab('guru',this)"><i class="fas fa-chalkboard-teacher"></i> Guru</div>
      <div class="adm-nav-item" onclick="switchTab('galeri',this)"><i class="fas fa-images"></i> Galeri</div>
      <div class="adm-nav-item" onclick="switchTab('berita',this)"><i class="fas fa-newspaper"></i> Berita</div>
      <div class="adm-stitle">Pengaturan</div>
      <div class="adm-nav-item" onclick="switchTab('password',this)"><i class="fas fa-key"></i> Ganti Password</div>
    </div>
    <div class="adm-content">
      <!-- UMUM -->
      <div class="adm-sec on" id="tab-umum">
        <div class="adm-sec-title">‚öôÔ∏è Pengaturan Umum &amp; Foto</div>
        <div class="adm-card"><div class="adm-card-title">Foto Hero (Banner Utama)</div>
          <div class="upz"><input type="file" accept="image/*" onchange="uploadSitePhoto(this,'hero_bg')"><i class="fas fa-cloud-upload-alt"></i><p>Klik atau drag foto background halaman utama (maks 2MB)</p></div>
          <div id="prevHero" style="margin-top:8px"></div>
        </div>
        <div class="adm-card"><div class="adm-card-title">Logo Navbar</div>
          <div class="upz"><input type="file" accept="image/*" onchange="uploadSitePhoto(this,'logo_nav')"><i class="fas fa-image"></i><p>Klik atau drag logo sekolah (maks 1MB)</p></div>
          <div id="prevLogo" style="margin-top:8px"></div>
        </div>
        <div class="adm-card">
          <div class="adm-card-title">Informasi Dasar</div>
          <div class="ag2">
            <div><label class="albl">ALAMAT</label><input class="ai" id="aAlamat" placeholder="Alamat sekolah"></div>
            <div><label class="albl">EMAIL</label><input class="ai" id="aEmail" placeholder="Email sekolah"></div>
            <div><label class="albl">WHATSAPP</label><input class="ai" id="aWa" placeholder="Nomor WA"></div>
            <div><label class="albl">TAHUN BERDIRI</label><input class="ai" id="aTahun" placeholder="cth: 3 Mei 2006"></div>
          </div>
          <button class="adm-btn adm-gold" onclick="saveSettings()" style="margin-top:12px"><i class="fas fa-save"></i> Simpan</button>
        </div>
      </div>
      <!-- PROFIL -->
      <div class="adm-sec" id="tab-profil">
        <div class="adm-sec-title">üè´ Profil Sekolah</div>
        <div class="adm-card"><div class="adm-card-title">Foto Gedung Sekolah</div>
          <div class="upz"><input type="file" accept="image/*" onchange="uploadSitePhoto(this,'profil_photo')"><i class="fas fa-image"></i><p>Klik atau drag foto gedung sekolah</p></div>
          <div id="prevProfil" style="margin-top:8px"></div>
        </div>
        <div class="adm-card">
          <div class="adm-card-title">Deskripsi Profil</div>
          <label class="albl">PARAGRAF 1</label><textarea class="ai ta" id="aProfil1"></textarea>
          <label class="albl">PARAGRAF 2</label><textarea class="ai ta" id="aProfil2"></textarea>
          <label class="albl">PARAGRAF 3</label><textarea class="ai ta" id="aProfil3"></textarea>
          <button class="adm-btn adm-gold" onclick="saveProfil()" style="margin-top:12px"><i class="fas fa-save"></i> Simpan</button>
        </div>
      </div>
      <!-- VISMIS -->
      <div class="adm-sec" id="tab-vismis">
        <div class="adm-sec-title">üëÅÔ∏è Visi, Misi &amp; Tujuan</div>
        <div class="adm-card"><div class="adm-card-title">Visi</div><textarea class="ai ta" id="aVisi"></textarea><button class="adm-btn adm-gold" onclick="save1('visi','aVisi','Visi')" style="margin-top:10px"><i class="fas fa-save"></i> Simpan</button></div>
        <div class="adm-card"><div class="adm-card-title">Misi <small style="color:rgba(255,255,255,.3);font-size:10px">(satu poin per baris)</small></div><textarea class="ai" style="min-height:160px" id="aMisi"></textarea><button class="adm-btn adm-gold" onclick="save1('misi','aMisi','Misi')" style="margin-top:10px"><i class="fas fa-save"></i> Simpan</button></div>
        <div class="adm-card"><div class="adm-card-title">Tujuan <small style="color:rgba(255,255,255,.3);font-size:10px">(satu poin per baris)</small></div><textarea class="ai" style="min-height:130px" id="aTujuan"></textarea><button class="adm-btn adm-gold" onclick="save1('tujuan','aTujuan','Tujuan')" style="margin-top:10px"><i class="fas fa-save"></i> Simpan</button></div>
      </div>
      <!-- FASILITAS -->
      <div class="adm-sec" id="tab-fasilitas">
        <div class="adm-sec-title">üè¢ Fasilitas</div>
        <div class="adm-card">
          <div class="adm-card-title">Tambah Fasilitas</div>
          <div class="ag2">
            <div><label class="albl">NAMA</label><input class="ai" id="nfNama" placeholder="cth: Lab Komputer"><label class="albl">IKON (emoji)</label><input class="ai" id="nfIcon" placeholder="cth: üíª"></div>
            <div><label class="albl">DESKRIPSI</label><textarea class="ai ta" id="nfDesc" placeholder="Deskripsi singkat..."></textarea></div>
          </div>
          <label class="albl" style="margin-top:8px">FOTO (opsional)</label>
          <div class="upz" style="padding:1rem"><input type="file" accept="image/*" id="nfFoto"><i class="fas fa-image"></i><p>Upload foto fasilitas</p></div>
          <div id="prevNf" style="margin-top:6px"></div>
          <button class="adm-btn adm-teal" onclick="addFasilitas()" style="margin-top:10px"><i class="fas fa-plus"></i> Tambah</button>
        </div>
        <div class="adm-card"><div class="adm-card-title">Daftar Fasilitas</div><div id="fasilitasList"></div></div>
      </div>
      <!-- EKSKUL -->
      <div class="adm-sec" id="tab-ekskul">
        <div class="adm-sec-title">üèÉ Ekstrakurikuler</div>
        <div class="adm-card">
          <div class="adm-card-title">Tambah Ekskul</div>
          <div class="ag2">
            <div><label class="albl">NAMA</label><input class="ai" id="neNama" placeholder="cth: Pramuka"><label class="albl">IKON</label><input class="ai" id="neIcon" placeholder="cth: ‚öúÔ∏è"><label class="albl">PEMBINA</label><input class="ai" id="nePembina" placeholder="Nama pembina"></div>
            <div><label class="albl">DESKRIPSI</label><textarea class="ai ta" id="neDesc" placeholder="Deskripsi kegiatan..."></textarea></div>
          </div>
          <label class="albl" style="margin-top:8px">FOTO KEGIATAN (bisa beberapa)</label>
          <div class="upz"><input type="file" accept="image/*" multiple id="neFotos" onchange="previewMulti(this,'prevNe')"><i class="fas fa-camera"></i><p>Upload foto kegiatan ekskul</p></div>
          <div class="pgrid" id="prevNe"></div>
          <button class="adm-btn adm-teal" onclick="addEkskul()" style="margin-top:10px"><i class="fas fa-plus"></i> Tambah</button>
        </div>
        <div class="adm-card"><div class="adm-card-title">Daftar Ekskul</div><div id="ekskulList"></div></div>
      </div>
      <!-- GURU -->
      <div class="adm-sec" id="tab-guru">
        <div class="adm-sec-title">üë®‚Äçüè´ Guru &amp; Kepala Sekolah</div>
        <div class="adm-card">
          <div class="adm-card-title">Tambah Guru</div>
          <div class="ag3">
            <div><label class="albl">NAMA</label><input class="ai" id="ngNama" placeholder="Nama lengkap"><label class="albl">JABATAN</label><select class="ai" id="ngJabatan"><option>Kepala Sekolah</option><option>Wakil Kepala Sekolah</option><option>Guru</option><option>Staff</option><option>BP/BK</option></select></div>
            <div><label class="albl">MATA PELAJARAN</label><input class="ai" id="ngMapel" placeholder="cth: Matematika"><label class="albl">NIP (opsional)</label><input class="ai" id="ngNip" placeholder="NIP guru"></div>
            <div><label class="albl">FOTO GURU</label><div class="upz" style="padding:1.2rem"><input type="file" accept="image/*" id="ngFoto" onchange="previewSingle(this,'prevNg')"><i class="fas fa-user-circle"></i><p style="font-size:11px">Upload foto</p></div><div id="prevNg"></div></div>
          </div>
          <button class="adm-btn adm-teal" onclick="addGuru()" style="margin-top:10px"><i class="fas fa-plus"></i> Tambah</button>
        </div>
        <div class="adm-card"><div class="adm-card-title">Daftar Guru</div><div id="guruList"></div></div>
      </div>
      <!-- GALERI -->
      <div class="adm-sec" id="tab-galeri">
        <div class="adm-sec-title">üñºÔ∏è Galeri Foto</div>
        <div class="adm-card">
          <div class="adm-card-title">Upload Foto Galeri</div>
          <div class="upz"><input type="file" accept="image/*" multiple onchange="addGaleri(this)"><i class="fas fa-images"></i><p>Upload foto galeri (bisa sekaligus banyak, maks 1MB per foto)</p></div>
          <label class="albl" style="margin-top:10px">KETERANGAN (opsional)</label>
          <input class="ai" id="galCaption" placeholder="Keterangan foto">
          <div id="galProgress" style="display:none" class="prog"><span id="galProgText">Mengupload...</span><div class="prog-bar"><div class="prog-fill" id="galProgFill" style="width:0%"></div></div></div>
        </div>
        <div class="adm-card"><div class="adm-card-title">Foto Galeri <span id="galCount" style="color:rgba(255,255,255,.4);font-size:11px"></span></div><div class="pgrid" id="galAdminGrid" style="grid-template-columns:repeat(5,1fr)"></div></div>
      </div>
      <!-- BERITA -->
      <div class="adm-sec" id="tab-berita">
        <div class="adm-sec-title">üì∞ Berita &amp; Pengumuman</div>
        <div class="adm-card">
          <div class="adm-card-title">Tambah Berita</div>
          <label class="albl">JUDUL</label><input class="ai" id="nbJudul" placeholder="Judul berita">
          <div class="ag2"><div><label class="albl">KATEGORI</label><select class="ai" id="nbKat"><option>Pengumuman</option><option>Prestasi</option><option>Kegiatan</option><option>Akademik</option><option>Umum</option></select></div><div><label class="albl">TANGGAL</label><input type="date" class="ai" id="nbTgl"></div></div>
          <label class="albl">ISI BERITA</label><textarea class="ai" style="min-height:110px" id="nbIsi" placeholder="Isi berita..."></textarea>
          <label class="albl" style="margin-top:8px">FOTO (opsional)</label>
          <div class="upz" style="padding:1rem"><input type="file" accept="image/*" id="nbFoto" onchange="previewSingle(this,'prevNb')"><i class="fas fa-image"></i><p>Upload foto berita</p></div>
          <div id="prevNb" style="margin-top:6px;max-width:180px"></div>
          <button class="adm-btn adm-teal" onclick="addBerita()" style="margin-top:10px"><i class="fas fa-paper-plane"></i> Publikasikan</button>
        </div>
        <div class="adm-card"><div class="adm-card-title">Daftar Berita</div><div id="beritaList"></div></div>
      </div>
      <!-- PASSWORD -->
      <div class="adm-sec" id="tab-password">
        <div class="adm-sec-title">üîë Ganti Password Admin</div>
        <div class="adm-card" style="max-width:420px">
          <div class="adm-card-title">Ubah Password</div>
          <label class="albl">PASSWORD LAMA</label><input type="password" class="ai" id="pwLama" placeholder="Password saat ini">
          <label class="albl">PASSWORD BARU</label><input type="password" class="ai" id="pwBaru" placeholder="Min. 6 karakter">
          <label class="albl">KONFIRMASI</label><input type="password" class="ai" id="pwKonfirm" placeholder="Ulangi password baru">
          <button class="adm-btn adm-gold" onclick="gantiPassword()" style="margin-top:14px;width:100%"><i class="fas fa-key"></i> Ganti Password</button>
          <p style="color:rgba(255,255,255,.3);font-size:11px;text-align:center;margin-top:10px">Password default: alfiil2024</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="toast"></div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<!-- uploadSitePhoto replaces uploadPhoto -->
<script>

/* ================================================================
   SMA AL-FIIL ‚Äî Realtime Multi-Device
   Data teks  : Firestore (gratis, tanpa kartu kredit)
   Foto       : Cloudinary (gratis 25GB, tanpa kartu kredit)
   Sinkronisasi: Firestore onSnapshot = perubahan admin langsung
                 tampil di HP, laptop, semua perangkat secara instan
================================================================ */

// ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let CFG = null;   // {projectId, cloudName, uploadPreset}
let db = null;
let isAdmin = false;
let unsubs = [];  // firestore listeners
let SD = {};      // local cache

const CFG_KEY = 'smaalfiil-cfg';
const PW_KEY  = 'smaalfiil-pw';

// ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function boot() {
  renderDefaults();
  CFG = loadCfg();
  if (CFG && CFG.projectId) {
    await initFirestore(CFG.projectId);
  }
  checkHashAccess();
}
boot();

// ‚îÄ‚îÄ CONFIG PERSISTENCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadCfg() {
  try { return JSON.parse(localStorage.getItem(CFG_KEY)); } catch(e) { return null; }
}
function saveCfg(c) {
  localStorage.setItem(CFG_KEY, JSON.stringify(c));
  CFG = c;
}

// ‚îÄ‚îÄ FIRESTORE REST API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Menggunakan Firestore REST + EventSource (SSE) untuk realtime
// TANPA Firebase SDK ‚Äî hanya fetch biasa
const FS_BASE = () => `https://firestore.googleapis.com/v1/projects/${CFG.projectId}/databases/(default)/documents`;

async function fsGet(col, docId) {
  const r = await fetch(`${FS_BASE()}/${col}/${docId}`);
  if (!r.ok) return null;
  const d = await r.json();
  return fsParseDoc(d);
}
async function fsList(col) {
  const r = await fetch(`${FS_BASE()}/${col}`);
  if (!r.ok) return [];
  const d = await r.json();
  if (!d.documents) return [];
  return d.documents.map(fsParseDoc);
}
async function fsSet(col, docId, data) {
  // PATCH = merge/create
  const fields = fsEncodeFields(data);
  const r = await fetch(`${FS_BASE()}/${col}/${docId}?updateMask.fieldPaths=${Object.keys(data).join('&updateMask.fieldPaths=')}`, {
    method:'PATCH', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({fields})
  });
  if (!r.ok) throw new Error(await r.text());
  return await r.json();
}
async function fsAdd(col, data) {
  const fields = fsEncodeFields(data);
  const r = await fetch(`${FS_BASE()}/${col}`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({fields})
  });
  if (!r.ok) throw new Error(await r.text());
  return await r.json();
}
async function fsDel(col, docId) {
  const r = await fetch(`${FS_BASE()}/${col}/${docId}`, {method:'DELETE'});
  if (!r.ok) throw new Error(await r.text());
}

// Firestore field encoding/decoding
function fsEncodeFields(obj) {
  const fields = {};
  for (const [k,v] of Object.entries(obj)) {
    if (v === null || v === undefined) fields[k] = {nullValue: null};
    else if (typeof v === 'boolean') fields[k] = {booleanValue: v};
    else if (typeof v === 'number') fields[k] = {integerValue: String(v)};
    else if (Array.isArray(v)) fields[k] = {arrayValue: {values: v.map(item =>
      typeof item === 'string' ? {stringValue: item} : {stringValue: JSON.stringify(item)}
    )}};
    else fields[k] = {stringValue: String(v)};
  }
  return fields;
}
function fsParseDoc(doc) {
  if (!doc || !doc.fields) return null;
  const out = {};
  // Extract id from name path
  if (doc.name) out._id = doc.name.split('/').pop();
  for (const [k,v] of Object.entries(doc.fields)) {
    if (v.stringValue !== undefined) out[k] = v.stringValue;
    else if (v.integerValue !== undefined) out[k] = Number(v.integerValue);
    else if (v.booleanValue !== undefined) out[k] = v.booleanValue;
    else if (v.nullValue !== undefined) out[k] = null;
    else if (v.arrayValue) out[k] = (v.arrayValue.values||[]).map(i =>
      i.stringValue !== undefined ? i.stringValue : JSON.stringify(i)
    );
    else out[k] = null;
  }
  return out;
}

// ‚îÄ‚îÄ FIRESTORE REALTIME (polling setiap 3 detik) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Firestore REST tidak support SSE tanpa Auth, pakai polling ringan
let pollTimer = null;
let lastHash = '';

async function initFirestore(projectId) {
  try {
    setSyncStatus('syncing');
    // Test koneksi
    const r = await fetch(`https://firestore.googleapis.com/v1/projects/${projectId}/databases/(default)/documents/siteConfig/settings`);
    if (r.status === 403 || r.status === 400) {
      setSyncStatus('offline');
      toast('Firestore: Akses ditolak. Pastikan Rules sudah diatur (allow read, write: if true)','err');
      return;
    }
    await loadAllData();
    startRealtime();
    setSyncStatus('online');
    document.getElementById('rtBadge').style.display='flex';
  } catch(e) {
    setSyncStatus('offline');
    toast('Gagal konek Firestore: '+e.message,'err');
  }
}

async function loadAllData() {
  try {
    // Load settings
    const s = await fsGet('siteConfig','settings');
    if (s) { SD.settings = s; applySettings(s); }
    const img = await fsGet('siteConfig','images');
    if (img) { SD.images = img; applyImages(img); }
    // Load collections
    SD.fasilitas = (await fsList('fasilitas')).filter(Boolean);
    SD.ekskul = (await fsList('ekskul')).filter(Boolean);
    SD.guru = (await fsList('guru')).filter(Boolean);
    SD.galeri = (await fsList('galeri')).filter(Boolean);
    SD.berita = (await fsList('berita')).filter(Boolean);
    renderAll();
  } catch(e) { console.warn('loadAllData error:', e); }
}

function startRealtime() {
  if (pollTimer) clearInterval(pollTimer);
  // Poll setiap 4 detik ‚Äî ringan karena hanya check perubahan
  pollTimer = setInterval(async () => {
    if (!isAdmin) {
      try {
        // Cek versi settings sebagai "heartbeat" perubahan
        const s = await fsGet('siteConfig','settings');
        const h = JSON.stringify(s);
        if (h !== lastHash) { lastHash = h; await loadAllData(); }
      } catch(e) {}
    }
  }, 4000);
}

// ‚îÄ‚îÄ CLOUDINARY UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function uploadToCloudinary(file) {
  if (!CFG || !CFG.cloudName || !CFG.uploadPreset) {
    throw new Error('Cloudinary belum dikonfigurasi. Buka Setup terlebih dahulu.');
  }
  const fd = new FormData();
  fd.append('file', file);
  fd.append('upload_preset', CFG.uploadPreset);
  const r = await fetch(`https://api.cloudinary.com/v1_1/${CFG.cloudName}/image/upload`, {
    method: 'POST', body: fd
  });
  if (!r.ok) {
    const err = await r.json();
    throw new Error(err.error?.message || 'Upload gagal');
  }
  const d = await r.json();
  return d.secure_url;
}

// ‚îÄ‚îÄ SETUP PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openSetup() {
  document.getElementById('setupPanel').classList.add('on');
  if (CFG) {
    setVal('cfgProject', CFG.projectId||'');
    setVal('cfgCloud', CFG.cloudName||'');
    setVal('cfgPreset', CFG.uploadPreset||'');
  }
}
function closeSetup() { document.getElementById('setupPanel').classList.remove('on'); }

async function saveSetup() {
  const projectId = v('cfgProject').trim();
  const cloudName = v('cfgCloud').trim();
  const uploadPreset = v('cfgPreset').trim();
  if (!projectId) return toast('Project ID Firestore wajib diisi!','warn');
  toast('Menghubungkan...','warn');
  saveCfg({projectId, cloudName, uploadPreset});
  await initFirestore(projectId);
  closeSetup();
  toast('Konfigurasi disimpan! Website terhubung.','ok');
}

// ‚îÄ‚îÄ RENDER DEFAULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderDefaults() {
  if (!SD.settings) SD.settings = {
    alamat:'Jln. Gajah Eretan No. 19, Gajah Mekar - Kutawaringin, Kab. Bandung',
    email:'smaalfiil15@gmail.com', wa:'085659627944', tahun:'3 Mei 2006',
    visi:'"Terwujudnya sekolah yang berprestasi, mandiri, dan kreatif berdasarkan iman dan taqwa."',
    misi:'Meningkatkan keimanan dan ketaqwaan bagi seluruh warga sekolah\nMelaksanakan proses pembelajaran yang interaktif, inspiratif dan menyenangkan\nMenciptakan suasana lingkungan sekolah yang kondusif untuk KBM\nMewujudkan fasilitas sekolah yang memadai\nMeningkatkan prestasi dan kreatifitas siswa di bidang seni, budaya dan olah raga\nMeningkatkan ketrampilan siswa di bidang kewirausahaan',
    tujuan:'Terwujudnya lingkungan sekolah yang religius\nTerciptanya lingkungan belajar yang kondusif dan nyaman\nTerwujudnya peningkatan prestasi akademik yang unggul\nTerwujudnya lulusan yang berkualitas dan siap kerja\nTerciptanya kemitraan harmonis dengan berbagai pihak',
    profil1:'SMA AL-FIIL merupakan lembaga pendidikan menengah atas yang berdiri sejak 3 Mei 2006, dengan komitmen kuat dalam membentuk generasi yang tangguh, mandiri, dan siap mengabdi.',
    profil2:'Sekolah hadir tidak hanya menekankan pencapaian akademik, tetapi juga pembentukan karakter, akhlak mulia, serta nilai kebersamaan dalam lingkungan yang religius dan kekeluargaan.',
    profil3:'Dengan tenaga pendidik berdedikasi serta program pendidikan berimbang antara akademik, karakter, dan ekstrakurikuler, SMA AL-FIIL menciptakan lingkungan belajar yang aman, nyaman, dan inspiratif.',
  };
  if (!SD.fasilitas) SD.fasilitas=[{_id:'f1',nama:'Lapangan Olahraga',icon:'‚öΩ',desc:'Sarana pembinaan kesehatan dan sportivitas.',img:''},{_id:'f2',nama:'Lab Komputer',icon:'üíª',desc:'Menunjang pembelajaran teknologi digital.',img:''},{_id:'f3',nama:'Perpustakaan',icon:'üìö',desc:'Ruang belajar dan memperluas wawasan.',img:''},{_id:'f4',nama:'Mushola',icon:'üïå',desc:'Sarana ibadah warga sekolah.',img:''},{_id:'f5',nama:'Ruang Kelas',icon:'üè´',desc:'Ruang belajar yang nyaman.',img:''},{_id:'f6',nama:'Kantin',icon:'üç±',desc:'Menyediakan kebutuhan makan siswa.',img:''}];
  if (!SD.ekskul) SD.ekskul=[{_id:'e1',nama:'Pramuka',icon:'‚öúÔ∏è',pembina:'-',desc:'Membentuk karakter mandiri dan cinta tanah air.',imgs:[]},{_id:'e2',nama:'Olahraga',icon:'üèÉ',pembina:'-',desc:'Pembinaan jasmani dan prestasi olahraga.',imgs:[]},{_id:'e3',nama:'Seni & Budaya',icon:'üé®',pembina:'-',desc:'Pengembangan bakat seni dan budaya daerah.',imgs:[]},{_id:'e4',nama:'Kewirausahaan',icon:'üíº',pembina:'-',desc:'Pelatihan keterampilan berwirausaha.',imgs:[]}];
  if (!SD.guru) SD.guru=[{_id:'g1',nama:'Kepala Sekolah',jabatan:'Kepala Sekolah',mapel:'-',nip:'-',photo:''}];
  if (!SD.galeri) SD.galeri=[];
  if (!SD.berita) SD.berita=[{_id:'b1',judul:'Selamat Datang di Website SMA AL-FIIL',kategori:'Pengumuman',tanggal:new Date().toISOString().split('T')[0],isi:'Website resmi SMA AL-FIIL kini hadir untuk memudahkan akses informasi sekolah.',img:''}];
  renderAll();
}

// ‚îÄ‚îÄ RENDER PUBLIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAll() {
  applySettings(SD.settings);
  renderFasilitas(); renderEkskul(); renderGuru(); renderGaleri(); renderBerita();
}
function applySettings(s) {
  if (!s) return;
  setText('infoAlamat',s.alamat); setText('infoEmail',s.email); setText('infoWa',s.wa);
  setText('ktAlamat',s.alamat);
  const em=document.getElementById('ktEmail'); if(em&&s.email){em.textContent=s.email;em.href='mailto:'+s.email;}
  if(s.visi) setText('visiTeks',s.visi);
  if(s.misi){const li=s.misi.split('\n').filter(l=>l.trim());document.getElementById('misiList').innerHTML=li.map(l=>`<li>${escH(l.trim())}</li>`).join('');}
  if(s.tujuan){const li=s.tujuan.split('\n').filter(l=>l.trim());document.getElementById('tujuanList').innerHTML=li.map(l=>`<li>${escH(l.trim())}</li>`).join('');}
  if(s.profil1||s.profil2||s.profil3)document.getElementById('profilTeks').innerHTML=`<p>${escH(s.profil1||'')}</p><p>${escH(s.profil2||'')}</p><p>${escH(s.profil3||'')}</p>`;
}
function applyImages(imgs) {
  if(!imgs)return;
  if(imgs.hero_bg)showImg('heroImgEl','heroImgBox',imgs.hero_bg);
  if(imgs.profil_photo)showImg('profilImgEl','profilImgBox',imgs.profil_photo);
  if(imgs.logo_nav){const el=document.getElementById('navLogo');if(el)el.innerHTML=`<img src="${imgs.logo_nav}" alt="Logo">`;}
}
function showImg(iId,bId,src){const el=document.getElementById(iId);const bx=document.getElementById(bId);if(el){el.src=src;el.style.display='block';}if(bx){const ph=bx.querySelector('span');if(ph)ph.style.display='none';}}
function renderFasilitas(){const g=document.getElementById('fasilitasGrid');if(!g)return;g.innerHTML=(SD.fasilitas||[]).map(f=>`<div class="fas-card"><div class="fas-img">${f.img?`<img src="${f.img}" alt="${escH(f.nama)}">`:`<span>${f.icon||'üè¢'}</span>`}</div><div class="fas-body"><h3>${f.icon||''} ${escH(f.nama)}</h3><p>${escH(f.desc)}</p></div></div>`).join('');}
function renderEkskul(){const g=document.getElementById('ekskulGrid');if(!g)return;g.innerHTML=(SD.ekskul||[]).map(e=>`<div class="ek-card"><div class="ek-top"><div class="ek-ic">${e.icon||'‚≠ê'}</div><div><h3>${escH(e.nama)}</h3><p>Pembina: ${escH(e.pembina||'-')}</p></div></div><p class="ek-desc">${escH(e.desc||'')}</p>${(e.imgs||[]).length?`<div class="ek-photos">${e.imgs.map(i=>`<div class="ek-photo" onclick="openLightbox('${i}')"><img src="${i}"></div>`).join('')}</div>`:''}</div>`).join('');}
function renderGuru(){const g=document.getElementById('guruGrid');if(!g)return;const ord=['Kepala Sekolah','Wakil Kepala Sekolah','Guru','BP/BK','Staff'];const bc={'Kepala Sekolah':'b-kepala','Wakil Kepala Sekolah':'b-wakil','Guru':'b-guru','Staff':'b-staff','BP/BK':'b-guru'};g.innerHTML=[...(SD.guru||[])].sort((a,b)=>(ord.indexOf(a.jabatan)||99)-(ord.indexOf(b.jabatan)||99)).map(gu=>`<div class="guru-card ${gu.jabatan==='Kepala Sekolah'?'kepala':''}"><div class="guru-photo">${gu.photo?`<img src="${gu.photo}" alt="${escH(gu.nama)}">`:'<i class="fas fa-user-tie"></i>'}</div><h3>${escH(gu.nama)}</h3><div class="mapel">${escH(gu.mapel!=='-'?gu.mapel:'')}</div><span class="guru-badge ${bc[gu.jabatan]||'b-guru'}">${escH(gu.jabatan)}</span></div>`).join('');}
function renderGaleri(){const g=document.getElementById('galeriGrid');if(!g)return;if(!(SD.galeri||[]).length){g.innerHTML='<div class="gal-ph" style="height:180px">üì∑</div><div class="gal-ph" style="height:120px">üñºÔ∏è</div><div class="gal-ph" style="height:200px">üéûÔ∏è</div><div class="gal-ph" style="height:140px">üì∏</div>';return;}g.innerHTML=SD.galeri.map(item=>`<div class="gal-item" onclick="openLightbox('${item.img}')"><img src="${item.img}" alt="${escH(item.caption||'')}"><div class="gal-overlay"><span>${escH(item.caption||'')}</span></div></div>`).join('');}
function renderBerita(){const g=document.getElementById('beritaGrid');if(!g)return;g.innerHTML=(SD.berita||[]).map(b=>`<div class="berita-card"><div class="berita-thumb">${b.img?`<img src="${b.img}" alt="${escH(b.judul)}">`:'<span>üì∞</span>'}</div><div class="berita-body"><div class="berita-meta"><span class="berita-kat">${escH(b.kategori)}</span><span class="berita-tgl"><i class="fas fa-calendar-alt"></i>${fmtDate(b.tanggal)}</span></div><h3>${escH(b.judul)}</h3><p>${escH((b.isi||'').substring(0,130))}${(b.isi||'').length>130?'...':''}</p><span class="berita-more">Selengkapnya ‚Üí</span></div></div>`).join('');}

// ‚îÄ‚îÄ ADMIN LISTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAdminLists(){
  const fl=document.getElementById('fasilitasList');if(fl)fl.innerHTML=(SD.fasilitas||[]).map(f=>`<div class="alist-item"><div class="alist-content"><h4>${f.icon||''} ${escH(f.nama)}</h4><p>${escH((f.desc||'').substring(0,60))}</p></div><div class="alist-actions"><button class="adel" onclick="delItem('fasilitas','${f._id}')"><i class="fas fa-trash"></i></button></div></div>`).join('')||nodata();
  const el=document.getElementById('ekskulList');if(el)el.innerHTML=(SD.ekskul||[]).map(e=>`<div class="alist-item"><div class="alist-content"><h4>${e.icon||''} ${escH(e.nama)}</h4><p>Pembina: ${escH(e.pembina||'-')} | ${(e.imgs||[]).length} foto</p></div><div class="alist-actions"><button class="adel" onclick="delItem('ekskul','${e._id}')"><i class="fas fa-trash"></i></button></div></div>`).join('')||nodata();
  const gl=document.getElementById('guruList');if(gl)gl.innerHTML=(SD.guru||[]).map(g=>`<div class="alist-item"><div class="alist-content"><h4>${escH(g.nama)}</h4><p>${escH(g.jabatan)} | ${escH(g.mapel)}</p></div><div class="alist-actions"><button class="adel" onclick="delItem('guru','${g._id}')"><i class="fas fa-trash"></i></button></div></div>`).join('')||nodata();
  const gal=document.getElementById('galAdminGrid');const cnt=document.getElementById('galCount');
  if(gal){if(cnt)cnt.textContent=`(${(SD.galeri||[]).length} foto)`;gal.innerHTML=(SD.galeri||[]).map(item=>`<div class="pitem"><img src="${item.img}" alt=""><button class="prm" onclick="delItem('galeri','${item._id}')"><i class="fas fa-times"></i></button></div>`).join('');}
  const bl=document.getElementById('beritaList');if(bl)bl.innerHTML=(SD.berita||[]).map(b=>`<div class="alist-item"><div class="alist-content"><h4>${escH(b.judul)}</h4><p>${escH(b.kategori)} | ${fmtDate(b.tanggal)}</p></div><div class="alist-actions"><button class="adel" onclick="delItem('berita','${b._id}')"><i class="fas fa-trash"></i></button></div></div>`).join('')||nodata();
}

// ‚îÄ‚îÄ SAVE FUNCTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveSettings(){
  try{const s={alamat:v('aAlamat'),email:v('aEmail'),wa:v('aWa'),tahun:v('aTahun')};await fsSet('siteConfig','settings',s);SD.settings=Object.assign(SD.settings||{},s);applySettings(SD.settings);toast('Informasi disimpan & tampil di semua perangkat!','ok');}
  catch(e){toast('Gagal simpan: '+e.message,'err');}
}
async function saveProfil(){
  try{const s={profil1:v('aProfil1'),profil2:v('aProfil2'),profil3:v('aProfil3')};await fsSet('siteConfig','settings',s);Object.assign(SD.settings,s);applySettings(SD.settings);toast('Profil disimpan!','ok');}
  catch(e){toast('Gagal simpan: '+e.message,'err');}
}
async function save1(field,inputId){
  try{const s={[field]:v(inputId)};await fsSet('siteConfig','settings',s);Object.assign(SD.settings,s);applySettings(SD.settings);toast('Tersimpan!','ok');}
  catch(e){toast('Gagal simpan: '+e.message,'err');}
}
async function uploadSitePhoto(input,key){
  if(!input.files[0])return;
  if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
  toast('Mengupload foto...','warn');
  try{
    const url=await uploadToCloudinary(input.files[0]);
    await fsSet('siteConfig','images',{[key]:url});
    if(!SD.images)SD.images={};SD.images[key]=url;applyImages(SD.images);
    const pid={hero_bg:'prevHero',logo_nav:'prevLogo',profil_photo:'prevProfil'}[key];
    if(pid){const el=document.getElementById(pid);if(el)el.innerHTML=`<img src="${url}" style="width:100%;max-height:150px;object-fit:cover;border-radius:10px;margin-top:8px">`;}
    toast('Foto berhasil diupload!','ok');
  }catch(e){toast('Gagal upload foto: '+e.message,'err');}
}
async function addFasilitas(){
  const nama=v('nfNama');if(!nama)return toast('Nama wajib!','warn');
  toast('Menyimpan...','warn');
  try{
    let img='';
    if(document.getElementById('nfFoto').files[0]){
      if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
      img=await uploadToCloudinary(document.getElementById('nfFoto').files[0]);
    }
    const doc=await fsAdd('fasilitas',{nama,icon:v('nfIcon')||'üè¢',desc:v('nfDesc')||'-',img,order:(SD.fasilitas||[]).length+1});
    const parsed=fsParseDoc(doc);if(parsed){if(!SD.fasilitas)SD.fasilitas=[];SD.fasilitas.push(parsed);}
    renderFasilitas();renderAdminLists();
    clr('nfNama','nfIcon','nfDesc');document.getElementById('nfFoto').value='';document.getElementById('prevNf').innerHTML='';
    toast('Fasilitas ditambahkan!','ok');
  }catch(e){toast('Gagal: '+e.message,'err');}
}
async function addEkskul(){
  const nama=v('neNama');if(!nama)return toast('Nama wajib!','warn');
  toast('Menyimpan...','warn');
  try{
    const files=Array.from(document.getElementById('neFotos').files);
    const imgs=[];
    if(files.length){
      if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
      for(const f of files)imgs.push(await uploadToCloudinary(f));
    }
    const doc=await fsAdd('ekskul',{nama,icon:v('neIcon')||'‚≠ê',pembina:v('nePembina')||'-',desc:v('neDesc')||'-',imgs:imgs.join('||'),order:(SD.ekskul||[]).length+1});
    const parsed=fsParseDoc(doc);
    if(parsed){parsed.imgs=parsed.imgs?parsed.imgs.split('||').filter(Boolean):[];if(!SD.ekskul)SD.ekskul=[];SD.ekskul.push(parsed);}
    renderEkskul();renderAdminLists();
    clr('neNama','neIcon','nePembina','neDesc');document.getElementById('neFotos').value='';document.getElementById('prevNe').innerHTML='';
    toast('Ekskul ditambahkan!','ok');
  }catch(e){toast('Gagal: '+e.message,'err');}
}
async function addGuru(){
  const nama=v('ngNama');if(!nama)return toast('Nama wajib!','warn');
  toast('Menyimpan...','warn');
  try{
    let photo='';
    if(document.getElementById('ngFoto').files[0]){
      if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
      photo=await uploadToCloudinary(document.getElementById('ngFoto').files[0]);
    }
    const doc=await fsAdd('guru',{nama,jabatan:v('ngJabatan'),mapel:v('ngMapel')||'-',nip:v('ngNip')||'-',photo,order:(SD.guru||[]).length+1});
    const parsed=fsParseDoc(doc);if(parsed){if(!SD.guru)SD.guru=[];SD.guru.push(parsed);}
    renderGuru();renderAdminLists();
    clr('ngNama','ngMapel','ngNip');document.getElementById('ngFoto').value='';document.getElementById('prevNg').innerHTML='';
    toast('Guru ditambahkan!','ok');
  }catch(e){toast('Gagal: '+e.message,'err');}
}
async function addGaleri(input){
  const files=Array.from(input.files);if(!files.length)return;
  if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
  const caption=v('galCaption');
  const prog=document.getElementById('galProgress');const fill=document.getElementById('galProgFill');const txt=document.getElementById('galProgText');
  prog.style.display='flex';if(!SD.galeri)SD.galeri=[];
  try{
    for(let i=0;i<files.length;i++){
      fill.style.width=Math.round((i/files.length)*100)+'%';
      txt.textContent=`Mengupload ${i+1} dari ${files.length}...`;
      const url=await uploadToCloudinary(files[i]);
      const doc=await fsAdd('galeri',{img:url,caption,order:SD.galeri.length+1});
      const parsed=fsParseDoc(doc);if(parsed)SD.galeri.push(parsed);
    }
    fill.style.width='100%';input.value='';
    renderGaleri();renderAdminLists();
    toast(`${files.length} foto diupload!`,'ok');
  }catch(e){toast('Gagal upload: '+e.message,'err');}
  setTimeout(()=>{prog.style.display='none';fill.style.width='0%';},1000);
}
async function addBerita(){
  const judul=v('nbJudul'),isi=v('nbIsi');
  if(!judul||!isi)return toast('Judul dan isi wajib!','warn');
  toast('Mempublikasikan...','warn');
  try{
    let img='';
    if(document.getElementById('nbFoto').files[0]){
      if(!CFG?.cloudName)return toast('Setup Cloudinary dulu untuk upload foto!','warn');
      img=await uploadToCloudinary(document.getElementById('nbFoto').files[0]);
    }
    const doc=await fsAdd('berita',{judul,kategori:v('nbKat'),tanggal:v('nbTgl')||new Date().toISOString().split('T')[0],isi,img});
    const parsed=fsParseDoc(doc);if(parsed){if(!SD.berita)SD.berita=[];SD.berita.unshift(parsed);}
    renderBerita();renderAdminLists();
    clr('nbJudul','nbIsi');document.getElementById('nbFoto').value='';document.getElementById('prevNb').innerHTML='';
    toast('Berita dipublikasikan!','ok');
  }catch(e){toast('Gagal: '+e.message,'err');}
}
async function delItem(col,id){
  try{await fsDel(col,id);if(SD[col])SD[col]=SD[col].filter(x=>x._id!==id);renderAll();renderAdminLists();toast('Dihapus!','ok');}
  catch(e){toast('Gagal hapus: '+e.message,'err');}
}
async function gantiPassword(){
  const lama=document.getElementById('pwLama').value;
  const baru=document.getElementById('pwBaru').value;
  const konfirm=document.getElementById('pwKonfirm').value;
  const stored=localStorage.getItem(PW_KEY)||btoa('alfiil2024');
  if(btoa(lama)!==stored)return toast('Password lama salah!','err');
  if(!baru||baru.length<6)return toast('Min. 6 karakter!','warn');
  if(baru!==konfirm)return toast('Konfirmasi tidak cocok!','err');
  localStorage.setItem(PW_KEY,btoa(baru));
  clr('pwLama','pwBaru','pwKonfirm');toast('Password berhasil diubah!','ok');
}

// ‚îÄ‚îÄ PREVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function previewMulti(input,pid){const el=document.getElementById(pid);if(!el)return;el.innerHTML='';Array.from(input.files).forEach(f=>{const r=new FileReader();r.onload=e=>{const d=document.createElement('div');d.className='pitem';d.innerHTML=`<img src="${e.target.result}">`;el.appendChild(d);};r.readAsDataURL(f);});}
function previewSingle(input,pid){if(!input.files[0])return;const el=document.getElementById(pid);if(!el)return;const r=new FileReader();r.onload=e=>{el.innerHTML=`<div class="pitem" style="max-width:100px;height:80px"><img src="${e.target.result}"></div>`;};r.readAsDataURL(input.files[0]);}

// ‚îÄ‚îÄ HIDDEN ADMIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SEQ=['a','d','m','i','n'];let seqBuf=[],seqT=null;
document.addEventListener('keydown',e=>{
  if(['INPUT','TEXTAREA','SELECT'].includes(document.activeElement.tagName))return;
  if(e.key==='Escape'){document.querySelectorAll('.modal-bg.on').forEach(m=>m.classList.remove('on'));closeLightbox();return;}
  seqBuf.push(e.key.toLowerCase());if(seqBuf.length>SEQ.length)seqBuf.shift();
  clearTimeout(seqT);seqT=setTimeout(()=>seqBuf=[],2000);
  if(seqBuf.join('')===SEQ.join('')){seqBuf=[];openLogin();}
});
let tapCount=0,tapT=null;
document.getElementById('footerBrand').addEventListener('click',()=>{tapCount++;clearTimeout(tapT);tapT=setTimeout(()=>tapCount=0,3000);if(tapCount>=5){tapCount=0;openLogin();}});
function checkHashAccess(){if(window.location.hash==='#admin-panel'){history.replaceState(null,'',window.location.pathname+window.location.search);setTimeout(openLogin,400);}}
window.addEventListener('hashchange',checkHashAccess);

function openLogin(){document.getElementById('loginModal').classList.add('on');setTimeout(()=>document.getElementById('loginPw').focus(),150);}
async function doLogin(){
  const pw=document.getElementById('loginPw').value;
  const stored=localStorage.getItem(PW_KEY)||btoa('alfiil2024');
  if(btoa(pw)===stored){
    closeModal('loginModal');document.getElementById('loginPw').value='';
    // Cek apakah sudah setup
    if(!CFG||!CFG.projectId){openSetup();return;}
    openAdminPanel();
  }else{toast('Password salah!','err');document.getElementById('loginPw').value='';document.getElementById('loginPw').focus();}
}
function openAdminPanel(){
  isAdmin=true;document.getElementById('adminPanel').classList.add('on');
  const s=SD.settings||{};
  setVal('aAlamat',s.alamat||'');setVal('aEmail',s.email||'');setVal('aWa',s.wa||'');setVal('aTahun',s.tahun||'');
  setVal('aProfil1',s.profil1||'');setVal('aProfil2',s.profil2||'');setVal('aProfil3',s.profil3||'');
  setVal('aVisi',s.visi||'');setVal('aMisi',s.misi||'');setVal('aTujuan',s.tujuan||'');
  document.getElementById('nbTgl').value=new Date().toISOString().split('T')[0];
  renderAdminLists();toast('Selamat datang, Admin! üéâ','ok');
}
function logoutAdmin(){isAdmin=false;document.getElementById('adminPanel').classList.remove('on');toast('Keluar dari admin.','ok');}
function openPanduan(){document.getElementById('panduanModal').classList.add('on');}
function closeModal(id){document.getElementById(id).classList.remove('on');}

// ‚îÄ‚îÄ UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab,el){document.querySelectorAll('.adm-sec').forEach(s=>s.classList.remove('on'));document.querySelectorAll('.adm-nav-item').forEach(n=>n.classList.remove('on'));document.getElementById('tab-'+tab).classList.add('on');el.classList.add('on');}
function toggleNav(){document.getElementById('navMenu').classList.toggle('open');}
function openLightbox(src){document.getElementById('lbImg').src=src;document.getElementById('lightbox').classList.add('on');document.body.style.overflow='hidden';}
function closeLightbox(){document.getElementById('lightbox').classList.remove('on');document.body.style.overflow='';}
function setSyncStatus(state){const el=document.getElementById('syncStatus');if(!el)return;const m={online:'‚óè Real-time aktif',syncing:'‚óã Menyinkron...',offline:'‚úï Offline'};el.textContent=m[state]||state;el.className='sync-status'+(state==='offline'?' offline':state==='syncing'?' syncing':'');}
let toastT;function toast(msg,type=''){const t=document.getElementById('toast');const ic={ok:'check-circle',err:'exclamation-circle',warn:'exclamation-triangle'};t.innerHTML=`<i class="fas fa-${ic[type]||'info-circle'}"></i> ${msg}`;t.className=`on ${type}`;clearTimeout(toastT);toastT=setTimeout(()=>t.classList.remove('on'),4000);}
function v(id){return(document.getElementById(id)||{}).value||'';}
function setVal(id,val){const el=document.getElementById(id);if(el)el.value=val;}
function setText(id,val){const el=document.getElementById(id);if(el&&val)el.textContent=val;}
function clr(...ids){ids.forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});}
function escH(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function nodata(){return'<p style="color:rgba(255,255,255,.3);font-size:12px;padding:8px">Belum ada data.</p>';}
function fmtDate(d){if(!d)return'-';const m=['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];const p=d.split('-');return`${p[2]||''} ${m[(parseInt(p[1])||1)-1]} ${p[0]||''}`;}
function kirimWA(){const txt=encodeURIComponent(`Assalamu'alaikum SMA AL-FIIL,\n\nNama: ${v('fNama')}\nSubjek: ${v('fSubjek')}\n\n${v('fPesan')}`);window.open(`https://wa.me/6285659627944?text=${txt}`,'_blank');}

window.addEventListener('scroll',()=>{
  const ids=['home','profil','visi-misi','fasilitas','ekstrakurikuler','guru','galeri','berita','kontak'];
  const y=window.scrollY+90;
  ids.forEach(id=>{const el=document.getElementById(id);if(!el)return;if(y>=el.offsetTop&&y<el.offsetTop+el.offsetHeight){document.querySelectorAll('.nav-menu a').forEach(a=>a.classList.remove('active'));const a=document.querySelector(`.nav-menu a[href="#${id}"]`);if(a)a.classList.add('active');}});
});
document.querySelectorAll('.modal-bg').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('on');});});

</script>
</body>
</html>